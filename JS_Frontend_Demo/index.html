<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Laser Power Diagnostics — JS Frontend Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h1>激光器功率诊断工具 — JS Demo</h1>
  <input type="file" id="fileInput">
  <div id="plot"></div>
  <pre id="result"></pre>
  <script>
    document.getElementById('fileInput').addEventListener('change', function(e){
      let file = e.target.files[0];
      Papa.parse(file, {
        header: true,
        dynamicTyping: true,
        complete: function(results){
          let data = results.data;
          let times = data.map(r => r.time);
          let power = data.map(r => r.power);
          Plotly.newPlot('plot',[{x:times,y:power,mode:'lines+markers',name:'Power'}]);
          // simple regression: correlate with water_temp
          let temps = data.map(r => r.water_temp);
          function linreg(x,y){
            let n=x.length, xmean=x.reduce((a,b)=>a+b,0)/n, ymean=y.reduce((a,b)=>a+b,0)/n;
            let num=0,den=0; for(let i=0;i<n;i++){num+=(x[i]-xmean)*(y[i]-ymean);den+=(x[i]-xmean)**2;}
            let slope=num/den; let intercept=ymean-slope*xmean; return {slope,intercept};
          }
          let lr=linreg(temps,power);
          document.getElementById('result').textContent="线性回归 Power ~ water_temp: slope="+lr.slope.toFixed(3);
        }
      });
    });
  </script>
</body>
</html>
